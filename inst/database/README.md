# Database for `lossrx` Package: `actuarialdb`

## TLDR

Get up-and-running by simply entering this folder and running `docker-compose up --build` to build and run a container instance of the [actuarialdb]() locally on port 5432.

For reference here is the docker-compose.yml file:

```dockerfile
services:
    postgres:
        image: postgres:latest
        restart: always
        environment:
            POSTGRES_USER: postgres
            POSTGRES_PASSWORD: admin
            POSTGRES_DB: postgres
        logging:
            options:
                max-size: 10m
                max-file: "3"
        ports:
            - '5432:5432'
        volumes:
            - ./postgres-data:/var/lib/postgresql/data
            - ./SQL:/docker-entrypoint-initdb.d
```

## Structure

```bash
> tree inst/database

./inst/database
├── db.dbml
├── db.sql
├── Dockerfile
├── docker-compose-yml
├── package.json
├── config.yml
├── README.md
├── .vscode/
├── postgres-data/
├── backups/
├── scripts/
├── docs/
├── CSV/
├── SQL/
└── YAML/

8 directories, 7 files
```

## Root Level Files

- [db.sql](db.sql): `SQL` script to generate database schema - autogenerated using [DBML (Database Markup Language) Command Line Tool](https://www.dbml.org/home/#command-line-tool-cli) by running `dbml2sql db.dbml` against the [db.dbml](db.dbml) markup file.


- [db.dbml](db.dbml): `DBML` (Database Markup Language) script for converting `SQL` into documentation. I originally generated this document using [dbdiagram](https://dbdiagram.io/).

- [Dockerfile](Dockerfile) and [docker-compose.yml]: Used to create database PostgreSQL container instance.

- [config.yml](config.yml): Used by the R package `config` to load database connection credentials and gain access to the database from R.

## postgres-data

This directory is mapped to the docker containers volume as a locally mounted docker volume to store postgresql data related to the database and persist this data across container runtimes. Most of this directories contents are git ignored, however I left some configs for observational purposes.
  
## Scripts

The [scripts](scripts) directory houses various utility `.sh`, `.R`, `.ps1`, etc. scripts or queries related to our database.

## Backups

The [backup](backups) directory houses any snapshots or database backup files.

## SQL

SQL scripts to create database schema and tables.

## CSV

CSV data files to seed data into the database tables.

## YAML

YAML configuration files representing the database schema by table.
